{
  // BigBang shared preset â€“ base config, labels, and shared scripts
  "extends": [
    "local>platform-one/big-bang/pipeline-templates/renovate-runner"
  ],
  "enabledManagers": [
    "helmv3",
    "custom.regex"
  ],
  "labels": [
    "istioCRDs",
    "Big Bang Core",
    "Package Sustainment",
    "kind::maintenance",
    "renovate"
  ],
  "postUpdateOptions": [
    "helmUpdateSubChartArchives"
  ],
  "customManagers": [
    {
      // Syncs appVersion to the upstream Istio base chart release
      "customType": "regex",
      "description": "Update chart appVersion to match upstream",
      "managerFilePatterns": ["/^chart/Chart\\.yaml$/"],
      "matchStrings": ["appVersion:\\s+(?<currentValue>.+)"],
      "autoReplaceStringTemplate": "appVersion: {{newValue}}",
      "depNameTemplate": "base",
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://istio-release.storage.googleapis.com/charts"
    },
    {
      // Keeps the bigbang.dev/applicationVersions annotation in lockstep
      "customType": "regex",
      "description": "Update big bang application versions",
      "managerFilePatterns": ["/^chart/Chart.yaml$/"],
      "matchStrings": ["- Istio:\\s+(?<currentValue>.+)"],
      "autoReplaceStringTemplate": "- Istio: {{newValue}}",
      "depNameTemplate": "base",
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://istio-release.storage.googleapis.com/charts"
    }
  ],
  "postUpgradeTasks": {
    "commands": [
      // Sets chart version = appVersion + "-bb.0" on upstream bumps;
      // increments -bb.N suffix on deps-only changes.
      // Replaces the old regex-based version manager and avoids the
      // minor-version-bump bug in bump-chart-yaml.
      "match-chart-yaml-appversion",
      "regenerate-helm-docs",
      "bump-changelog '- {{{replace 'registry1.dso.mil/' '' depName}}} updated from {{{currentVersion}}} to {{{newVersion}}}'"
    ],
    "fileFilters": [
      "chart/Chart.yaml",
      "README.md",
      "CHANGELOG.md"
    ]
  }
}
